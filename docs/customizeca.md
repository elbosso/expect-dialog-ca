## How can i customize my CA?

### Before creation

Before running `create_ca.sh`, it is probably a good idea to set some defaults. You do
that by editing a file called _ca_presets.ini_.
This file has to reside in the current directory. Its format is `key="value"`. The double quotes can be
omitted if the value does not contain spaces. Allowed keys at this time are:

* countryName
  used for the subject data and for the default values for config items
  in end user configs (see below)
* organizationName
  used for the subject data and for the default values for config items
  in end user configs (see below)
* organizationalUnitName
  used for the subject data and for the default values for config items
  in end user configs (see below)
* commonName
  used for the subject data
* base_url
  used for the configuration of the CA - everywhere where an URL is needed;
  for example location of CA certificate, CRL,...
* stateOrProvinceName
  used in end user configs (see below)
* localityName
  used in end user configs (see below)

A template for this file can be generated by calling `create_ca.sh` with command line
switch `-g`.

### During creation

After starting `create_ca.sh`, you are asked first for the type of the CA. the available types are 
fetched from the templates. an example for the choices available may look like this:

![type of CA](images/screenshot_001.png)

The next step is to enter the name of the CA. This is at the same time
the name of the directory all files belonging to this new CA are put into. So make sure there
is no file or directory with this name in the current directory. Also do not use the following names:

* root
* network
* identity
* component
* software

![name of CA](images/screenshot_002.png)

After that, the script asks for the URL of the associated OCSP responder. If you do not want or have one,
just leave that field blank - otherwise, you must enter a valid URL for accessing the responder here!

![OCSP responder for CA](images/screenshot_004.png)

Now, the script shows the information read from _ca_presets.ini_ (if applicable):

![options read from ca_presets.ini](images/screenshot_005.png)

And the user can afterwards change / enter the Distinguishes Name for the CA:

![DN for CA](images/screenshot_006.png)

The next step is the specification of the key length:

![key length](images/screenshot_008.png)

and the hash or message digest algorithm:

![message digest](images/screenshot_007.png)

Now, the script informs you about the possibilities to enter default values for Certificate
Signing Requests (CSRs). Each CA offers different flavours of certificates it can issue. For each of 
these, the script generates a config file to facilitate the creation of CSRs. And each
of these config files can have default values set for the fields inside the distinguished name.
Setting default values makes it a little easier and more convenient for end entities to 
create CSRs.

![CSR defaults info](images/screenshot_009.png)

It is not necessary to specify such defaults for all flavours - you can choose which ones 
you want:

![flavours for CSR defaults](images/screenshot_010.png)

If you choose at least one - a dialog like this one here is displayed to enter the default values:

![CSR defaults dialog](images/screenshot_011.png)

Afterwards, you are informed that you can specify Certificate Policy Statements (CPSs)
for each flavour:

![CSP info](images/screenshot_012.png)

It is not necessary to specify CPSs for all flavours - you can choose which ones
you want:

![flavours for CPSs](images/screenshot_013.png)

If you choose at least one - a dialog like this one here is displayed 
to let you enter the information for each CPS:

![CPS info dialog](images/screenshot_014.png)

The next step is to define any custom OIDs you want to use while working with this 
new CA. You are informed about that possibility like so:

![custom OID info](images/screenshot_015.png)

The dialog for entering identifier, OID and description is repeatedly shown as long as all three fields
are filled - giving you the opportunity to enter an arbitrary number of custom OIDs. The script
does not allow to re-use an already entered identifier or OID:

![custom OID dialog](images/screenshot_016.png)

Now, you have to enter a password to protect the private key of the CA:

![private key password dialog](images/screenshot_017.png)

The next step is to specify the location for the log:

![log location](images/screenshot_018.png)

Then, the certificate signing request is displayed:

![CSR for CA](images/screenshot_019.png)

And that concludes the process - the script shows some informational messages to wrap it all up:

![info display](images/screenshot_020.png)

![info policy display](images/screenshot_021.png)

![info publish display](images/screenshot_022.png)

![info log display](images/screenshot_023.png)

### After creation

After a CA is created, there are several possibilities to customize it further.

One good thing is to double check the configuration files in _etc_ for any 
mishaps to be fixed or general changes to be made there.

This directory _etc_ does not only hold the CAs configuration but it also
contains several configuration files that come in handy when entities want to
create Certificate signing requests for the CA to sign - they are created along 
the CAs other files when `create_ca.sh` is executed. The reason for there being more than one
is that a CA might issue different flavours of certificates according
to the intended usage scenario. For example - the Identity CA does generate
four different confguration files for creating CSRs:

* `encryption.conf`
* `identity.conf`
* `smime.conf`
* `smime_multi.conf`

Each one of these are used to create the CSR fit for the according usage scenario.

In the configuration file for the CA, one can find an extension section corresponding
to the different usage scenarions - with the Identity CA again as an example, these are:

* `encryption_ext`
* `identity_ext`
* `smime_ext`

These add differents sets of extensions to the certificate being created.

So, if a CA admin wanted to add another usage scenario, she has to think about wether
it would be advisable to make a new client configuration available so that
the requests contain special information needed for that scenario (for example other
fields in the CN). If so, she has to provide a new client configuration. One could 
use `smime_multi.conf` as an example - it is a variant of `smime.conf`, allowing 
to use the resulting certificate for more than one email address.

If a CA admin wanted to add different sets of extensions to some of the certificates being issued,
she has to add another extension section to the CAs configuration file. One
could use `smime_ext` as an example here: factory fresh it looks like this:

```
keyUsage                = critical,keyEncipherment,digitalSignature
basicConstraints        = CA:false
extendedKeyUsage        = emailProtection,msEFS,clientAuth,msSmartcardLogin
subjectKeyIdentifier    = hash
authorityKeyIdentifier  = keyid:always
authorityInfoAccess     = @issuer_info
crlDistributionPoints   = @crl_info
crlDistributionPoints   = @crl_info
```

One could add a new section named `smimeContentCommitment_ext` like the one
shown below:

```
keyUsage                = critical,nonRepudiation,keyEncipherment,digitalSignature
basicConstraints        = CA:false
extendedKeyUsage        = emailProtection,msEFS,clientAuth,msSmartcardLogin
subjectKeyIdentifier    = hash
authorityKeyIdentifier  = keyid:always
authorityInfoAccess     = @issuer_info
crlDistributionPoints   = @crl_info
crlDistributionPoints   = @crl_info
```


